---
custom_card_mpse_printer:
  show_icon: false
  show_label: false
  show_name: false
  styles:
    grid:
      - grid-template-areas: |
          [[[
            let json = {
              "printer_state": true,
              "black_ink": variables.card_printer_black_ink,
              "yellow_ink": variables.card_printer_yellow_ink,
              "magenta_ink": variables.card_printer_magenta_ink,
              "cyan_ink": variables.card_printer_cyan_ink
            };
            return "'" + Object.keys(json).filter(key => json[key] !== undefined).join("' '") + "'";
          ]]]
      - grid-template-columns: "1fr"
      - grid-template-rows: "min-content"
    card:
      - border-radius: "var(--border-radius)"
      - box-shadow: "var(--box-shadow)"
      - padding: "12px"
  custom_fields:
    printer_state:
      card:
        type: "custom:button-card"
        template: |
          [[[
            return entity.state.toLowerCase() != "idle" ? [ 'icon_info', 'blue_no_state' ] : [ 'icon_info' ];
          ]]]
        label: "[[[ return entity.state; ]]]"
        name: "[[[ return variables.card_printer_name !== undefined ? variables.card_printer_name : entity.attributes.friendly_name; ]]]"
        entity: "[[[ return entity.entity_id; ]]]"
        styles:
          card:
            - margin-bottom: |
                [[[
                  if ([ variables.card_printer_black_ink,
                        variables.card_printer_yellow_ink,
                        variables.card_printer_magenta_ink,
                        variables.card_printer_cyan_ink ].filter(value => value !== undefined).length > 0) {
                    return "7px";
                  }
                  return undefined;
                ]]]

    black_ink:
      card:
        type: "custom:button-card"
        template: "custom_card_mpse_printer_slider"
        variables:
          text_color: "white"
          bar_color: "black"
        entity: "[[[ return variables.card_printer_black_ink; ]]]"

    yellow_ink:
      card:
        type: "custom:button-card"
        template: "custom_card_mpse_printer_slider"
        variables:
          text_color: "black"
          bar_color: "yellow"
        entity: "[[[ return variables.card_printer_yellow_ink; ]]]"

    magenta_ink:
      card:
        type: "custom:button-card"
        template: "custom_card_mpse_printer_slider"
        variables:
          text_color: "white"
          bar_color: "magenta"
        entity: "[[[ return variables.card_printer_magenta_ink; ]]]"

    cyan_ink:
      card:
        type: "custom:button-card"
        template: "custom_card_mpse_printer_slider"
        variables:
          text_color: "black"
          bar_color: "cyan"
        entity: "[[[ return variables.card_printer_cyan_ink; ]]]"

custom_card_mpse_printer_slider:
  variables:
    text_color: "white"
    bar_color: "black"
  show_icon: false
  show_label: false
  show_name: false
  styles:
    grid:
      - display: "flex"
    card:
      - display: "block"
      - box-shadow: "none"
      - padding: "0px"
    custom_fields:
      slider:
        - width: "100%"
  custom_fields:
    slider: |
      [[[
        if (entity) {
          return `<div class="container">
            <div class="bar" style="background-color: ${variables.bar_color}; color: ${variables.text_color}; width: ${entity.state}%;">
              ${entity.state}%
            </div>
          </div>`;
        }
      ]]]
  style: |
    ha-card .container {
      position: relative;
      margin-top: 3px;
      margin-bottom: 2px;
      border-radius: 13px;
      padding: 3px;
      border: 0.01rem solid rgba(var(--color-theme),.4);
    }

    ha-card .bar {
      height: 20px;
      line-height: 20px;
      min-width: 35px;
      border-radius: 10px;
      border: 0.01rem solid rgba(var(--color-theme),.4);
      font-size: smaller;
      font-weight: bolder;
      padding-left: 8px;
      box-sizing: border-box;
      text-align: left;
    }
